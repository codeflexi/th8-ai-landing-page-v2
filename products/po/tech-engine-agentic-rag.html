<!doctype html>
<html lang="th">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TH8.AI ‚Äî Procurement Decision Center (Agentic RAG + Audit-First Architecture)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      html, body { font-family: "Prompt", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
      code, pre, .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace; }
    </style>
  </head>

  <body class="bg-slate-50 text-slate-900">
    <!-- Top -->
    <div class="sticky top-0 z-50 border-b border-slate-200 bg-white/90 backdrop-blur">
      <div class="mx-auto max-w-7xl px-4 py-3 flex items-center justify-between gap-4">
        <div>
          <div class="text-xs text-slate-500">TH8.AI Demo Blueprint</div>
          <div class="text-sm font-semibold">Procurement Decision Center ‚Äî Agentic RAG + Audit-First (FastAPI + Vue 3)</div>
        </div>
        <div class="hidden md:flex items-center gap-2">
          <span class="inline-flex items-center rounded-full border border-slate-200 bg-white px-3 py-1 text-xs text-slate-700">
            Audit = immutable fact
          </span>
          <span class="inline-flex items-center rounded-full border border-slate-200 bg-white px-3 py-1 text-xs text-slate-700">
            UI derives decision status from audit
          </span>
          <span class="inline-flex items-center rounded-full border border-slate-200 bg-white px-3 py-1 text-xs text-slate-700">
            Agent outputs = evidence (not answers)
          </span>
        </div>
      </div>
    </div>

    <div class="mx-auto max-w-7xl px-4 py-8 space-y-10">
      <!-- Header -->
      <section class="space-y-3">
        <div class="inline-flex items-center gap-2">
          <span class="h-2.5 w-2.5 rounded-full bg-red-600"></span>
          <p class="text-xs uppercase tracking-wider text-slate-500">Conceptual Model (End-to-end architecture, APIs, data model)</p>
        </div>
        <h1 class="text-2xl md:text-3xl font-bold">
          Architecture Layers ‚Ä¢ API Surface ‚Ä¢ Data Model ‚Äî End to End
        </h1>
        <p class="text-slate-600 max-w-4xl">
          ‡∏™‡∏£‡∏∏‡∏õ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Demo ‡∏ó‡∏µ‡πà ‚Äú‡∏Ñ‡∏•‡∏¥‡∏Å‡πÑ‡∏î‡πâ‡∏à‡∏£‡∏¥‡∏á‚Äù ‡πÅ‡∏•‡∏∞ ‚Äú‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÑ‡∏î‡πâ‡∏à‡∏£‡∏¥‡∏á‚Äù ‡πÇ‡∏î‡∏¢‡πÅ‡∏¢‡∏Å 3 ‡πÅ‡∏Å‡∏ô:
          <span class="font-medium text-slate-900">Decision (Rule Engine)</span>,
          <span class="font-medium text-slate-900">Evidence (Agentic RAG)</span>,
          <span class="font-medium text-slate-900">Accountability (Audit Events)</span>
        </p>
      </section>

      <!-- Invariants -->
      <section class="rounded-2xl border border-slate-200 bg-white p-6">
        <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-3">
          <h2 class="text-lg font-semibold">Non-negotiables (Invariants)</h2>
          <div class="flex flex-wrap gap-2">
            <span class="rounded-full bg-slate-100 px-3 py-1 text-xs text-slate-700">No decision state in case</span>
            <span class="rounded-full bg-slate-100 px-3 py-1 text-xs text-slate-700">Audit is append-only</span>
            <span class="rounded-full bg-slate-100 px-3 py-1 text-xs text-slate-700">Backend does not derive UI meaning</span>
          </div>
        </div>
        <ul class="mt-4 grid grid-cols-1 md:grid-cols-2 gap-3 text-sm text-slate-700">
          <li class="flex gap-2">
            <span class="mt-1 h-2 w-2 rounded-full bg-red-600"></span>
            <span><span class="font-medium">audit event</span> ‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡πâ‡∏≠‡πÄ‡∏ó‡πá‡∏à‡∏à‡∏£‡∏¥‡∏á‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ (immutable fact)</span>
          </li>
          <li class="flex gap-2">
            <span class="mt-1 h-2 w-2 rounded-full bg-red-600"></span>
            <span><span class="font-medium">decision status</span> ‡∏ï‡πâ‡∏≠‡∏á derive ‡∏à‡∏≤‡∏Å audit events ‡∏ù‡∏±‡πà‡∏á frontend ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô</span>
          </li>
          <li class="flex gap-2">
            <span class="mt-1 h-2 w-2 rounded-full bg-red-600"></span>
            <span>‡∏´‡πâ‡∏≤‡∏°‡πÉ‡∏ä‡πâ <span class="mono bg-slate-100 px-1 rounded">case.status</span> ‡πÄ‡∏õ‡πá‡∏ô decision state</span>
          </li>
          <li class="flex gap-2">
            <span class="mt-1 h-2 w-2 rounded-full bg-red-600"></span>
            <span>Agentic RAG = <span class="font-medium">RAG-as-Evidence</span> (‡πÄ‡∏õ‡∏¥‡∏î PDF/Clause ‡πÑ‡∏î‡πâ) ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà ‚ÄúAI answer‚Äù</span>
          </li>
        </ul>
      </section>

      <!-- Architecture Layers -->
      <section class="space-y-4">
        <div class="flex items-end justify-between gap-4">
          <div>
            <h2 class="text-xl font-bold">1) Architecture Layers (Backend + Agentic RAG)</h2>
            <p class="text-slate-600 mt-1">‡πÅ‡∏¢‡∏Å layer ‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏ñ‡∏µ‡∏¢‡∏£‡πÅ‡∏•‡∏∞ auditability</p>
          </div>
        </div>

        <div class="rounded-2xl border border-slate-200 bg-white p-6">
          <div class="grid grid-cols-1 lg:grid-cols-12 gap-4">
            <!-- UI -->
            <div class="lg:col-span-3 rounded-2xl border border-slate-200 bg-slate-50 p-4">
              <div class="text-xs text-slate-500">Presentation</div>
              <div class="mt-1 font-semibold">Vue 3 UI</div>
              <ul class="mt-3 text-sm text-slate-700 space-y-2">
                <li>‚Ä¢ Case List / Case Detail</li>
                <li>‚Ä¢ Run Decision / Evidence Panel</li>
                <li>‚Ä¢ Approve/Reject Modal</li>
                <li>‚Ä¢ Audit Timeline (derive status)</li>
              </ul>
              <div class="mt-4 rounded-xl border border-slate-200 bg-white p-3 text-xs text-slate-600">
                UI computes: decision_status, evidence badges, required_role banners
              </div>
            </div>

            <!-- API -->
            <div class="lg:col-span-3 rounded-2xl border border-slate-200 bg-slate-50 p-4">
              <div class="text-xs text-slate-500">Interface</div>
              <div class="mt-1 font-semibold">FastAPI</div>
              <ul class="mt-3 text-sm text-slate-700 space-y-2">
                <li>‚Ä¢ REST endpoints</li>
                <li>‚Ä¢ Request validation</li>
                <li>‚Ä¢ AuthZ role gates (optional)</li>
                <li>‚Ä¢ Correlation IDs (optional)</li>
              </ul>
              <div class="mt-4 rounded-xl border border-slate-200 bg-white p-3 text-xs text-slate-600">
                API returns facts + technical results only (no UI meaning)
              </div>
            </div>

            <!-- Domain -->
            <div class="lg:col-span-3 rounded-2xl border border-slate-200 bg-slate-50 p-4">
              <div class="text-xs text-slate-500">Domain</div>
              <div class="mt-1 font-semibold">Business Logic</div>
              <ul class="mt-3 text-sm text-slate-700 space-y-2">
                <li>‚Ä¢ Decision Engine (rules)</li>
                <li>‚Ä¢ Agent Orchestrator (tools)</li>
                <li>‚Ä¢ Event Factory (payload schema)</li>
              </ul>
              <div class="mt-4 rounded-xl border border-slate-200 bg-white p-3 text-xs text-slate-600">
                Deterministic & testable (pure functions where possible)
              </div>
            </div>

            <!-- Data -->
            <div class="lg:col-span-3 rounded-2xl border border-slate-200 bg-slate-50 p-4">
              <div class="text-xs text-slate-500">Data</div>
              <div class="mt-1 font-semibold">Postgres + Vector</div>
              <ul class="mt-3 text-sm text-slate-700 space-y-2">
                <li>‚Ä¢ cases (facts only)</li>
                <li>‚Ä¢ audit_events (immutable log)</li>
                <li>‚Ä¢ documents/clauses</li>
                <li>‚Ä¢ document_embeddings (vector)</li>
                <li>‚Ä¢ agent_memory (non-audit)</li>
              </ul>
              <div class="mt-4 rounded-xl border border-slate-200 bg-white p-3 text-xs text-slate-600">
                Audit is source-of-truth for decision flow
              </div>
            </div>
          </div>

          <!-- Two tracks -->
          <div class="mt-6 grid grid-cols-1 lg:grid-cols-2 gap-4">
            <div class="rounded-2xl border border-slate-200 bg-white p-5">
              <div class="flex items-center justify-between">
                <div>
                  <div class="text-xs text-slate-500">Track A</div>
                  <div class="font-semibold">Decision Engine (Rules)</div>
                </div>
                <span class="rounded-full bg-slate-100 px-3 py-1 text-xs text-slate-700">Writes audit only</span>
              </div>
              <ul class="mt-3 text-sm text-slate-700 space-y-2">
                <li>‚Ä¢ Input: immutable case facts + policy_id/version</li>
                <li>‚Ä¢ Output: rule_results + recommendation (technical)</li>
                <li>‚Ä¢ Writes: <span class="mono">RULE_EVALUATED</span>, <span class="mono">DECISION_RECOMMENDED</span></li>
                <li>‚Ä¢ Does not: set decision status, update case</li>
              </ul>
            </div>

            <div class="rounded-2xl border border-slate-200 bg-white p-5">
              <div class="flex items-center justify-between">
                <div>
                  <div class="text-xs text-slate-500">Track B</div>
                  <div class="font-semibold">Agentic RAG (Evidence)</div>
                </div>
                <span class="rounded-full bg-slate-100 px-3 py-1 text-xs text-slate-700">RAG-as-Evidence</span>
              </div>
              <ul class="mt-3 text-sm text-slate-700 space-y-2">
                <li>‚Ä¢ Tools: SQL reader (facts), Vector search (clauses)</li>
                <li>‚Ä¢ Memory: agent_memory (continuity, not audit)</li>
                <li>‚Ä¢ Output: evidence refs (doc_id/clause_id/open_url)</li>
                <li>‚Ä¢ Writes: <span class="mono">EVIDENCE_ATTACHED</span> (optional on run)</li>
              </ul>
            </div>
          </div>
        </div>
      </section>

      <!-- API Surface -->
      <section class="space-y-4">
        <div>
          <h2 class="text-xl font-bold">2) API Surface (End-to-End)</h2>
          <p class="text-slate-600 mt-1">‡∏ä‡∏∏‡∏î API ‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡πÉ‡∏´‡πâ Step 0‚Äì6 + Agentic RAG ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Ñ‡∏£‡∏ö</p>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
          <!-- Step 0-2 -->
          <div class="rounded-2xl border border-slate-200 bg-white p-6">
            <div class="flex items-center justify-between">
              <h3 class="font-semibold">Step 0‚Äì2 (Existing)</h3>
              <span class="text-xs text-slate-500">Do not change</span>
            </div>
            <div class="mt-4 space-y-3 text-sm">
              <div class="rounded-xl bg-slate-50 border border-slate-200 p-4">
                <div class="font-medium">Ingest Case</div>
                <div class="mt-1 text-slate-600"><span class="mono">POST /api/v1/demo/ingest</span> (or existing)</div>
                <div class="mt-2 text-xs text-slate-500">Writes: CASE_INGESTED (+ escalation events)</div>
              </div>
              <div class="rounded-xl bg-slate-50 border border-slate-200 p-4">
                <div class="font-medium">Case Detail</div>
                <div class="mt-1 text-slate-600"><span class="mono">GET /api/v1/cases/{case_id}</span></div>
                <div class="mt-2 text-xs text-slate-500">UI derives decision status from audit (already)</div>
              </div>
            </div>
          </div>

          <!-- Step 3-6 -->
          <div class="rounded-2xl border border-red-200 bg-red-50/40 p-6">
            <div class="flex items-center justify-between">
              <h3 class="font-semibold">Step 3‚Äì6 (To implement)</h3>
              <span class="text-xs text-slate-500">Audit-first</span>
            </div>
            <div class="mt-4 space-y-3 text-sm">
              <div class="rounded-xl bg-white border border-red-200 p-4">
                <div class="font-medium">Run Decision</div>
                <div class="mt-1 text-slate-700"><span class="mono">POST /api/v1/decisions/run</span></div>
                <div class="mt-2 text-xs text-slate-600">Writes: RULE_EVALUATED (n), DECISION_RECOMMENDED (1)</div>
              </div>
              <div class="rounded-xl bg-white border border-red-200 p-4">
                <div class="font-medium">Attach Evidence</div>
                <div class="mt-1 text-slate-700"><span class="mono">POST /api/v1/evidence/attach</span></div>
                <div class="mt-2 text-xs text-slate-600">Writes: EVIDENCE_ATTACHED (1)</div>
              </div>
              <div class="rounded-xl bg-white border border-red-200 p-4">
                <div class="font-medium">Approve / Reject</div>
                <div class="mt-1 text-slate-700"><span class="mono">POST /api/v1/decisions/submit</span></div>
                <div class="mt-2 text-xs text-slate-600">Writes: DECISION_SUBMITTED (1)</div>
              </div>
              <div class="rounded-xl bg-white border border-red-200 p-4">
                <div class="font-medium">Audit Timeline</div>
                <div class="mt-1 text-slate-700"><span class="mono">GET /api/v1/audit/case/{case_id}</span></div>
                <div class="mt-2 text-xs text-slate-600">Returns: ordered immutable events (no derived state)</div>
              </div>
            </div>
          </div>

          <!-- Agentic RAG -->
          <div class="rounded-2xl border border-slate-200 bg-white p-6 lg:col-span-2">
            <div class="flex items-center justify-between">
              <h3 class="font-semibold">Agentic RAG (Evidence Agent)</h3>
              <span class="mono text-xs rounded bg-slate-100 px-2 py-1">POST /api/v1/agent/rag/run</span>
            </div>
            <p class="text-sm text-slate-600 mt-2">
              Agent ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å SQL + Vector + Memory ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡∏∑‡∏ô ‚Äúevidence refs‚Äù ‡πÅ‡∏•‡∏∞ (‡∏ñ‡πâ‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤) ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô <span class="mono">EVIDENCE_ATTACHED</span>
            </p>

            <div class="mt-4 grid grid-cols-1 md:grid-cols-3 gap-3 text-sm">
              <div class="rounded-xl bg-slate-50 border border-slate-200 p-4">
                <div class="font-medium">Tools</div>
                <ul class="mt-2 text-slate-700 space-y-1">
                  <li>‚Ä¢ SQL reader</li>
                  <li>‚Ä¢ Vector search</li>
                  <li>‚Ä¢ Doc resolver</li>
                </ul>
              </div>
              <div class="rounded-xl bg-slate-50 border border-slate-200 p-4">
                <div class="font-medium">Memory</div>
                <ul class="mt-2 text-slate-700 space-y-1">
                  <li>‚Ä¢ short_term</li>
                  <li>‚Ä¢ long_term (optional)</li>
                  <li>‚Ä¢ not audit</li>
                </ul>
              </div>
              <div class="rounded-xl bg-slate-50 border border-slate-200 p-4">
                <div class="font-medium">Output</div>
                <ul class="mt-2 text-slate-700 space-y-1">
                  <li>‚Ä¢ evidence list</li>
                  <li>‚Ä¢ open_url</li>
                  <li>‚Ä¢ snippet</li>
                </ul>
              </div>
            </div>

            <div class="mt-4 grid grid-cols-1 lg:grid-cols-2 gap-4">
              <div>
                <div class="text-xs font-semibold text-slate-700">Request</div>
                <pre class="mt-2 text-xs bg-slate-950 text-slate-100 rounded-xl p-4 overflow-auto"><code>{
  "case_id": "CASE-2026-0007",
  "question": "‡∏£‡∏≤‡∏Ñ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ Ergonomic Chair ‡∏ï‡∏≤‡∏°‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏Ñ‡∏∑‡∏≠‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏´‡∏£‡πà",
  "attach_as_evidence": true,
  "actor": { "type": "system", "id": "rag.agent", "role": "system" }
}</code></pre>
              </div>
              <div>
                <div class="text-xs font-semibold text-slate-700">Response</div>
                <pre class="mt-2 text-xs bg-slate-950 text-slate-100 rounded-xl p-4 overflow-auto"><code>{
  "answer": "‡∏û‡∏ö‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô‡πÉ‡∏ô‡∏™‡∏±‡∏ç‡∏ç‡∏≤ Office Supply Contract 2024 ‡∏Ç‡πâ‡∏≠ 4.2 ...",
  "evidence_refs": [
    {
      "doc_id": "DOC-CT-2024-001",
      "clause_id": "CL-4.2",
      "open_url": "/api/v1/docs/DOC-CT-2024-001/open?page=12",
      "relevance": 0.92,
      "snippet": "Pricing for Ergonomic Chair is 4,500 THB per unit..."
    }
  ],
  "audit_written": { "evidence_attached_events": 1 }
}</code></pre>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Data Model -->
      <section class="space-y-4">
        <div>
          <h2 class="text-xl font-bold">3) Data Model (End-to-End)</h2>
          <p class="text-slate-600 mt-1">‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏´‡∏•‡∏±‡∏Å + ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå + event payload ‡∏ó‡∏µ‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö trace/audit</p>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
          <!-- Core tables -->
          <div class="rounded-2xl border border-slate-200 bg-white p-6">
            <h3 class="font-semibold">Core Tables</h3>
            <div class="mt-4 space-y-3 text-sm">
              <div class="rounded-xl border border-slate-200 bg-slate-50 p-4">
                <div class="flex items-center justify-between">
                  <div class="font-medium">cases</div>
                  <span class="text-xs text-slate-500">facts only</span>
                </div>
                <div class="mt-2 grid grid-cols-2 gap-2 text-xs text-slate-700">
                  <span class="rounded bg-white border border-slate-200 px-2 py-1">case_id (PK)</span>
                  <span class="rounded bg-white border border-slate-200 px-2 py-1">external_status</span>
                  <span class="rounded bg-white border border-slate-200 px-2 py-1">amount_thb</span>
                  <span class="rounded bg-white border border-slate-200 px-2 py-1">sla_due_at</span>
                  <span class="rounded bg-white border border-slate-200 px-2 py-1">vendor_id</span>
                  <span class="rounded bg-white border border-slate-200 px-2 py-1">doc_set_id</span>
                </div>
                <div class="mt-3 text-xs text-red-700">
                  üö´ No decision_status / no approval_state in cases
                </div>
              </div>

              <div class="rounded-xl border border-slate-200 bg-slate-50 p-4">
                <div class="flex items-center justify-between">
                  <div class="font-medium">audit_events</div>
                  <span class="text-xs text-slate-500">append-only</span>
                </div>
                <div class="mt-2 grid grid-cols-2 gap-2 text-xs text-slate-700">
                  <span class="rounded bg-white border border-slate-200 px-2 py-1">event_id (PK)</span>
                  <span class="rounded bg-white border border-slate-200 px-2 py-1">case_id (FK)</span>
                  <span class="rounded bg-white border border-slate-200 px-2 py-1">event_type</span>
                  <span class="rounded bg-white border border-slate-200 px-2 py-1">occurred_at</span>
                  <span class="rounded bg-white border border-slate-200 px-2 py-1">actor</span>
                  <span class="rounded bg-white border border-slate-200 px-2 py-1">payload (jsonb)</span>
                </div>
                <div class="mt-3 text-xs text-slate-600">
                  Source-of-truth for decision flow + evidence + accountability
                </div>
              </div>

              <div class="rounded-xl border border-slate-200 bg-slate-50 p-4">
                <div class="flex items-center justify-between">
                  <div class="font-medium">policies</div>
                  <span class="text-xs text-slate-500">immutable ref</span>
                </div>
                <div class="mt-2 grid grid-cols-2 gap-2 text-xs text-slate-700">
                  <span class="rounded bg-white border border-slate-200 px-2 py-1">policy_id</span>
                  <span class="rounded bg-white border border-slate-200 px-2 py-1">policy_version</span>
                  <span class="rounded bg-white border border-slate-200 px-2 py-1">rules (json)</span>
                  <span class="rounded bg-white border border-slate-200 px-2 py-1">published_at</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Agentic RAG tables -->
          <div class="rounded-2xl border border-slate-200 bg-white p-6">
            <h3 class="font-semibold">Agentic RAG Tables</h3>
            <div class="mt-4 space-y-3 text-sm">
              <div class="rounded-xl border border-slate-200 bg-slate-50 p-4">
                <div class="flex items-center justify-between">
                  <div class="font-medium">documents / clauses</div>
                  <span class="text-xs text-slate-500">evidence refs</span>
                </div>
                <div class="mt-2 grid grid-cols-2 gap-2 text-xs text-slate-700">
                  <span class="rounded bg-white border border-slate-200 px-2 py-1">doc_id</span>
                  <span class="rounded bg-white border border-slate-200 px-2 py-1">file_url</span>
                  <span class="rounded bg-white border border-slate-200 px-2 py-1">clause_id</span>
                  <span class="rounded bg-white border border-slate-200 px-2 py-1">page_range</span>
                </div>
              </div>

              <div class="rounded-xl border border-slate-200 bg-slate-50 p-4">
                <div class="flex items-center justify-between">
                  <div class="font-medium">document_embeddings</div>
                  <span class="text-xs text-slate-500">vector store</span>
                </div>
                <div class="mt-2 grid grid-cols-2 gap-2 text-xs text-slate-700">
                  <span class="rounded bg-white border border-slate-200 px-2 py-1">doc_id</span>
                  <span class="rounded bg-white border border-slate-200 px-2 py-1">clause_id</span>
                  <span class="rounded bg-white border border-slate-200 px-2 py-1">content</span>
                  <span class="rounded bg-white border border-slate-200 px-2 py-1">embedding (vector)</span>
                </div>
              </div>

              <div class="rounded-xl border border-slate-200 bg-slate-50 p-4">
                <div class="flex items-center justify-between">
                  <div class="font-medium">agent_memory</div>
                  <span class="text-xs text-slate-500">non-audit</span>
                </div>
                <div class="mt-2 grid grid-cols-2 gap-2 text-xs text-slate-700">
                  <span class="rounded bg-white border border-slate-200 px-2 py-1">agent_name</span>
                  <span class="rounded bg-white border border-slate-200 px-2 py-1">case_id</span>
                  <span class="rounded bg-white border border-slate-200 px-2 py-1">memory_type</span>
                  <span class="rounded bg-white border border-slate-200 px-2 py-1">content (jsonb)</span>
                </div>
                <div class="mt-3 text-xs text-slate-600">
                  ‡πÉ‡∏ä‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠ continuity ‡∏Ç‡∏≠‡∏á agent, ‡∏•‡∏ö‡πÑ‡∏î‡πâ/‡∏õ‡∏£‡∏±‡∏ö‡πÑ‡∏î‡πâ, ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏Ç‡πâ‡∏≠‡πÄ‡∏ó‡πá‡∏à‡∏à‡∏£‡∏¥‡∏á‡∏ó‡∏≤‡∏á audit
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Event payload model -->
        <div class="rounded-2xl border border-slate-200 bg-white p-6">
          <h3 class="font-semibold">Audit Event Payload Models (Key Types)</h3>
          <div class="mt-4 grid grid-cols-1 lg:grid-cols-3 gap-4 text-sm">
            <div class="rounded-xl border border-slate-200 bg-slate-50 p-4">
              <div class="font-medium">RULE_EVALUATED</div>
              <pre class="mt-2 text-xs bg-slate-950 text-slate-100 rounded-xl p-3 overflow-auto"><code>{
  "policy_id": "procurement_policy",
  "policy_version": "1.0.0",
  "rule": { "rule_id": "R-HIGH-AMOUNT", "severity": "high" },
  "inputs": { "amount_thb": 750000, "sla_hours_left": 6 },
  "result": { "hit": true, "reasons": ["amount_thb >= 500000"] }
}</code></pre>
            </div>

            <div class="rounded-xl border border-slate-200 bg-slate-50 p-4">
              <div class="font-medium">DECISION_RECOMMENDED</div>
              <pre class="mt-2 text-xs bg-slate-950 text-slate-100 rounded-xl p-3 overflow-auto"><code>{
  "policy_id": "procurement_policy",
  "policy_version": "1.0.0",
  "recommendation": {
    "action": "ESCALATE",
    "required_role": "manager",
    "confidence": 0.76,
    "notes": "High risk requires manager approval"
  },
  "derived_from": { "rule_hits": ["R-HIGH-AMOUNT", "R-SLA-RISK"] }
}</code></pre>
            </div>

            <div class="rounded-xl border border-slate-200 bg-slate-50 p-4">
              <div class="font-medium">EVIDENCE_ATTACHED</div>
              <pre class="mt-2 text-xs bg-slate-950 text-slate-100 rounded-xl p-3 overflow-auto"><code>{
  "question": "‡∏£‡∏≤‡∏Ñ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ Ergonomic Chair ‡∏ï‡∏≤‡∏°‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏Ñ‡∏∑‡∏≠‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏´‡∏£‡πà",
  "summary": "‡∏û‡∏ö‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô‡πÉ‡∏ô‡∏Ç‡πâ‡∏≠ 4.2 ...",
  "evidence": [
    {
      "doc_id": "DOC-CT-2024-001",
      "clause_id": "CL-4.2",
      "page_range": "12-13",
      "open_url": "/api/v1/docs/DOC-CT-2024-001/open?page=12",
      "relevance": 0.92
    }
  ]
}</code></pre>
            </div>
          </div>

          <div class="mt-4 grid grid-cols-1 lg:grid-cols-2 gap-4 text-sm">
            <div class="rounded-xl border border-slate-200 bg-slate-50 p-4">
              <div class="font-medium">DECISION_SUBMITTED</div>
              <pre class="mt-2 text-xs bg-slate-950 text-slate-100 rounded-xl p-3 overflow-auto"><code>{
  "decision": "REJECT",
  "reason": "Price exceeds contract clause 4.2",
  "reason_code": "PRICE_MISMATCH",
  "evidence_refs": [
    { "doc_id": "DOC-CT-2024-001", "clause_id": "CL-4.2", "open_url": "/api/v1/docs/DOC-CT-2024-001/open?page=12" }
  ]
}</code></pre>
            </div>

            <div class="rounded-xl border border-slate-200 bg-white p-4">
              <div class="font-semibold">UI Derivation (examples)</div>
              <ul class="mt-2 text-sm text-slate-700 space-y-2">
                <li>
                  ‚Ä¢ Decision status:
                  <span class="mono">DECISION_SUBMITTED</span> ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î ‚Üí Approved/Rejected
                  else <span class="mono">DECISION_RECOMMENDED</span> ‚Üí Pending Approval
                </li>
                <li>
                  ‚Ä¢ Evidence badge:
                  ‡∏°‡∏µ <span class="mono">EVIDENCE_ATTACHED</span> ‚Üí ‚ÄúEvidence ready‚Äù
                </li>
                <li>
                  ‚Ä¢ Required role banner:
                  ‡∏≠‡πà‡∏≤‡∏ô‡∏à‡∏≤‡∏Å <span class="mono">DECISION_RECOMMENDED.payload.recommendation.required_role</span>
                </li>
              </ul>
              <div class="mt-4 rounded-xl border border-slate-200 bg-slate-50 p-3 text-xs text-slate-600">
                Backend returns facts; UI interprets per policy.
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- End-to-end flows -->
      <section class="space-y-4">
        <div>
          <h2 class="text-xl font-bold">4) End-to-End Flows (What happens on each click)</h2>
          <p class="text-slate-600 mt-1">‡πÅ‡∏™‡∏î‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏Å API ‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô audit event ‡∏ï‡πà‡∏≠‡∏Ñ‡∏•‡∏¥‡∏Å</p>
        </div>

        <div class="rounded-2xl border border-slate-200 bg-white p-6">
          <div class="grid grid-cols-1 lg:grid-cols-3 gap-4">
            <!-- Flow A -->
            <div class="rounded-2xl border border-slate-200 bg-slate-50 p-5">
              <div class="text-xs text-slate-500">Flow A</div>
              <div class="font-semibold">Run Decision</div>
              <ol class="mt-3 text-sm text-slate-700 space-y-2 list-decimal list-inside">
                <li>UI calls <span class="mono">POST /decisions/run</span></li>
                <li>Backend reads immutable case facts</li>
                <li>Decision engine evaluates rules</li>
                <li>Append audit:
                  <span class="mono">RULE_EVALUATED</span> (n),
                  <span class="mono">DECISION_RECOMMENDED</span> (1)
                </li>
                <li>UI refresh timeline ‚Üí derives ‚ÄúPending approval‚Äù</li>
              </ol>
            </div>

            <!-- Flow B -->
            <div class="rounded-2xl border border-slate-200 bg-slate-50 p-5">
              <div class="text-xs text-slate-500">Flow B</div>
              <div class="font-semibold">Agentic RAG ‚Üí Evidence</div>
              <ol class="mt-3 text-sm text-slate-700 space-y-2 list-decimal list-inside">
                <li>UI calls <span class="mono">POST /agent/rag/run</span></li>
                <li>Agent loads memory (non-audit)</li>
                <li>Tool 1: SQL reader (relational facts)</li>
                <li>Tool 2: Vector search (clauses)</li>
                <li>(Optional) Append audit: <span class="mono">EVIDENCE_ATTACHED</span></li>
                <li>UI shows evidence refs + open_url</li>
              </ol>
            </div>

            <!-- Flow C -->
            <div class="rounded-2xl border border-slate-200 bg-slate-50 p-5">
              <div class="text-xs text-slate-500">Flow C</div>
              <div class="font-semibold">Approve / Reject</div>
              <ol class="mt-3 text-sm text-slate-700 space-y-2 list-decimal list-inside">
                <li>User selects decision + reason</li>
                <li>UI calls <span class="mono">POST /decisions/submit</span></li>
                <li>Backend appends audit: <span class="mono">DECISION_SUBMITTED</span></li>
                <li>UI refresh timeline ‚Üí derives final state</li>
                <li>Audit timeline shows who/when/why + evidence refs</li>
              </ol>
            </div>
          </div>
        </div>
      </section>

      <!-- Footer -->
      <footer class="pb-10">
        <div class="rounded-2xl border border-slate-200 bg-white p-6">
          <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
            <div>
              <div class="text-sm font-semibold">Implementation order (backend-first)</div>
              <div class="text-sm text-slate-600 mt-1">
                1) decisions/run ‚Üí 2) evidence/attach ‚Üí 3) decisions/submit ‚Üí 4) audit timeline
                ‚Üí 5) agent/rag/run (SQL+Vector+Memory) ‚Üí 6) docs open_url endpoints
              </div>
            </div>
            <div class="text-xs text-slate-500">
              Designed to keep Step 0‚Äì2 untouched and derive all decision meaning in UI.
            </div>
          </div>
        </div>
      </footer>
    </div>
  </body>
</html>
