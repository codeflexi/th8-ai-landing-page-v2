<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TH8 — Audit Timeline v2 (Expandable)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      html, body { font-family: "Prompt", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
      /* tiny helpers */
      .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
    </style>
  </head>

  <body class="bg-slate-50 text-slate-900">
    <div class="max-w-6xl mx-auto px-6 py-10 space-y-6">

      <!-- Header -->
      <div class="flex items-start justify-between">
        <div>
          <p class="text-xs uppercase tracking-wider text-slate-500">Enterprise Decision Center</p>
          <h1 class="text-2xl font-semibold mt-1">Audit Timeline (Expandable / Audit-grade)</h1>
          <p class="text-sm text-slate-600 mt-2">
            Source of truth: <span class="mono">audit event stream</span> • Grouped by <span class="mono">run_id</span>
          </p>
        </div>
        <div class="flex items-center gap-2">
          <span class="px-2.5 py-1 rounded-full bg-white border border-slate-200 text-xs text-slate-600">
            Case: <span class="mono">CASE-PO-OVT-2025-006</span>
          </span>
          <span class="px-2.5 py-1 rounded-full bg-white border border-slate-200 text-xs text-slate-600">
            Policy: <span class="mono">PROCUREMENT-001 / v3</span>
          </span>
        </div>
      </div>

      <!-- Layout -->
      <div class="grid grid-cols-12 gap-6">

        <!-- LEFT: Timeline -->
        <div class="col-span-8 space-y-4">

          <!-- Run Group -->
          <div class="bg-white border border-slate-200 rounded-2xl p-5 shadow-sm">
            <div class="flex items-start justify-between">
              <div>
                <p class="text-xs text-slate-500">Decision Run</p>
                <p class="mono text-sm font-semibold mt-1">run_id: 9867c2d5-ae19-431b-be90-e3abd85857fa</p>
                <p class="text-sm text-slate-600 mt-1">
                  Started: 2026-01-01 17:16:48Z • 3 events
                </p>
              </div>
              <div class="text-right">
                <p class="text-xs text-slate-500">Outcome</p>
                <p class="mt-1 inline-flex items-center gap-2 px-3 py-1.5 rounded-xl bg-emerald-50 text-emerald-800 border border-emerald-200 text-sm font-medium">
                  Recommended: APPROVE
                </p>
                <p class="text-xs text-slate-500 mt-2">
                  Required role: <span class="mono">Procurement_Manager</span>
                </p>
              </div>
            </div>

            <!-- Timeline list -->
            <div class="mt-6">
              <ol class="relative border-l border-slate-200 pl-6 space-y-4">

                <!-- Event 1 -->
                <li class="relative">
                  <span class="absolute -left-[10px] top-1.5 h-5 w-5 rounded-full bg-slate-900"></span>

                  <details class="group bg-slate-50 border border-slate-200 rounded-xl p-4">
                    <summary class="cursor-pointer list-none">
                      <div class="flex items-start justify-between gap-4">
                        <div class="min-w-0">
                          <p class="text-sm font-semibold text-slate-900">
                            RULE_EVALUATED — High value procurement must be escalated
                          </p>
                          <p class="text-xs text-slate-500 mt-1">
                            2026-01-01 17:16:48Z • Actor: <span class="mono">SYSTEM</span> • Authority: automated
                          </p>
                        </div>

                        <div class="flex items-center gap-2 shrink-0">
                          <span class="px-2 py-1 rounded-full bg-white border border-slate-200 text-xs text-slate-600 mono">
                            rule: HIGH_AMOUNT_ESCALATION
                          </span>
                          <span class="px-2 py-1 rounded-full bg-emerald-50 border border-emerald-200 text-xs text-emerald-800">
                            hit: false
                          </span>

                          <span class="text-xs text-slate-400 group-open:hidden">Expand</span>
                          <span class="text-xs text-slate-400 hidden group-open:inline">Collapse</span>
                        </div>
                      </div>
                    </summary>

                    <!-- Expanded details -->
                    <div class="mt-4 grid grid-cols-12 gap-4">
                      <div class="col-span-7 space-y-3">
                        <div class="bg-white rounded-xl border border-slate-200 p-3">
                          <p class="text-xs font-semibold text-slate-700">What</p>
                          <p class="text-sm text-slate-700 mt-1">Rule evaluated against case inputs.</p>
                        </div>
                        <div class="bg-white rounded-xl border border-slate-200 p-3">
                          <p class="text-xs font-semibold text-slate-700">Why</p>
                          <p class="text-sm text-slate-700 mt-1">
                            Validate escalation requirement for high value procurement.
                          </p>
                        </div>
                        <div class="bg-white rounded-xl border border-slate-200 p-3">
                          <p class="text-xs font-semibold text-slate-700">Inputs</p>
                          <div class="mt-2 text-sm text-slate-700 space-y-1">
                            <div class="flex justify-between"><span class="text-slate-500">amount_total</span><span class="mono">null</span></div>
                            <div class="flex justify-between"><span class="text-slate-500">hours_to_sla</span><span class="mono">null</span></div>
                          </div>
                        </div>
                      </div>

                      <div class="col-span-5 space-y-3">
                        <div class="bg-white rounded-xl border border-slate-200 p-3">
                          <p class="text-xs font-semibold text-slate-700">Impact</p>
                          <p class="text-sm text-slate-700 mt-1">
                            No escalation triggered (rule not hit).
                          </p>
                        </div>
                        <div class="bg-white rounded-xl border border-slate-200 p-3">
                          <p class="text-xs font-semibold text-slate-700">Policy Binding</p>
                          <p class="text-sm text-slate-700 mt-1">
                            <span class="mono">PROCUREMENT-001</span> / <span class="mono">v3</span>
                          </p>
                        </div>
                        <div class="bg-white rounded-xl border border-slate-200 p-3">
                          <p class="text-xs font-semibold text-slate-700">Links</p>
                          <div class="mt-2 text-sm text-slate-700 space-y-1">
                            <div class="flex justify-between">
                              <span class="text-slate-500">run_id</span>
                              <span class="mono">9867c2d5…57fa</span>
                            </div>
                            <div class="flex justify-between">
                              <span class="text-slate-500">case_id</span>
                              <span class="mono">CASE-…-006</span>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </details>
                </li>

                <!-- Event 2 -->
                <li class="relative">
                  <span class="absolute -left-[10px] top-1.5 h-5 w-5 rounded-full bg-slate-900"></span>

                  <details class="group bg-slate-50 border border-slate-200 rounded-xl p-4">
                    <summary class="cursor-pointer list-none">
                      <div class="flex items-start justify-between gap-4">
                        <div class="min-w-0">
                          <p class="text-sm font-semibold text-slate-900">
                            DECISION_RECOMMENDED — Recommend APPROVE
                          </p>
                          <p class="text-xs text-slate-500 mt-1">
                            2026-01-01 17:16:49Z • Actor: <span class="mono">SYSTEM</span> • Authority: automated
                          </p>
                        </div>

                        <div class="flex items-center gap-2 shrink-0">
                          <span class="px-2 py-1 rounded-full bg-emerald-50 border border-emerald-200 text-xs text-emerald-800 font-medium">
                            decision: APPROVE
                          </span>
                          <span class="px-2 py-1 rounded-full bg-white border border-slate-200 text-xs text-slate-600 mono">
                            role: Procurement_Manager
                          </span>

                          <span class="text-xs text-slate-400 group-open:hidden">Expand</span>
                          <span class="text-xs text-slate-400 hidden group-open:inline">Collapse</span>
                        </div>
                      </div>
                    </summary>

                    <div class="mt-4 grid grid-cols-12 gap-4">
                      <div class="col-span-7 space-y-3">
                        <div class="bg-white rounded-xl border border-slate-200 p-3">
                          <p class="text-xs font-semibold text-slate-700">What</p>
                          <p class="text-sm text-slate-700 mt-1">System recommended a decision action.</p>
                        </div>
                        <div class="bg-white rounded-xl border border-slate-200 p-3">
                          <p class="text-xs font-semibold text-slate-700">Why</p>
                          <p class="text-sm text-slate-700 mt-1">
                            No violated rules detected; safe to approve within policy.
                          </p>
                        </div>
                      </div>

                      <div class="col-span-5 space-y-3">
                        <div class="bg-white rounded-xl border border-slate-200 p-3">
                          <p class="text-xs font-semibold text-slate-700">Impact</p>
                          <p class="text-sm text-slate-700 mt-1">
                            Decision status can proceed to approval workflow.
                          </p>
                        </div>
                        <div class="bg-white rounded-xl border border-slate-200 p-3">
                          <p class="text-xs font-semibold text-slate-700">Traceability</p>
                          <p class="text-sm text-slate-700 mt-1">
                            Linked evidence available in the Evidence panel.
                          </p>
                        </div>
                      </div>
                    </div>
                  </details>
                </li>

                <!-- Event 3 -->
                <li class="relative">
                  <span class="absolute -left-[10px] top-1.5 h-5 w-5 rounded-full bg-red-700"></span>

                  <details class="group bg-red-50 border border-red-200 rounded-xl p-4">
                    <summary class="cursor-pointer list-none">
                      <div class="flex items-start justify-between gap-4">
                        <div class="min-w-0">
                          <p class="text-sm font-semibold text-slate-900">
                            EVIDENCE_ATTACHED — 1 evidence item linked (vector_search)
                          </p>
                          <p class="text-xs text-slate-600 mt-1">
                            2026-01-01 18:59:33Z • Actor: <span class="mono">SYSTEM</span> • Confidence: <span class="mono">0.72</span>
                          </p>
                        </div>

                        <div class="flex items-center gap-2 shrink-0">
                          <span class="px-2 py-1 rounded-full bg-white border border-red-200 text-xs text-red-800 font-medium">
                            audit-grade
                          </span>
                          <span class="text-xs text-slate-500 group-open:hidden">Expand</span>
                          <span class="text-xs text-slate-500 hidden group-open:inline">Collapse</span>
                        </div>
                      </div>
                    </summary>

                    <div class="mt-4 grid grid-cols-12 gap-4">
                      <div class="col-span-7 space-y-3">
                        <div class="bg-white rounded-xl border border-red-200 p-3">
                          <p class="text-xs font-semibold text-red-900">Based on (Evidence)</p>
                          <ul class="mt-2 text-sm text-slate-700 space-y-2">
                            <li class="flex items-start justify-between gap-3">
                              <div class="min-w-0">
                                <p class="font-medium text-slate-900 truncate">Procurement Policy 2024</p>
                                <p class="text-xs text-slate-500 mt-0.5 truncate">
                                  4.Approval / 4.2 High Value Procurement • Clause CL-4.2 • p.12–13
                                </p>
                                <div class="mt-2 flex flex-wrap gap-2">
                                  <span class="px-2 py-0.5 rounded-full bg-slate-100 text-slate-700 text-xs mono">supports: HIGH_AMOUNT_ESCALATION</span>
                                  <span class="px-2 py-0.5 rounded-full bg-slate-100 text-slate-700 text-xs mono">event: DECISION_RECOMMENDED</span>
                                </div>
                              </div>
                              <div class="shrink-0 text-right">
                                <p class="text-xs text-slate-500">score</p>
                                <p class="mono text-sm font-semibold">0.72</p>
                              </div>
                            </li>
                          </ul>
                        </div>
                      </div>

                      <div class="col-span-5 space-y-3">
                        <div class="bg-white rounded-xl border border-red-200 p-3">
                          <p class="text-xs font-semibold text-red-900">Why</p>
                          <p class="text-sm text-slate-700 mt-1">
                            Attach clause references so the decision can be audited without relying on AI-generated text.
                          </p>
                        </div>
                        <div class="bg-white rounded-xl border border-red-200 p-3">
                          <p class="text-xs font-semibold text-red-900">Impact</p>
                          <p class="text-sm text-slate-700 mt-1">
                            Adds verifiable source links (document + clause + page) to the run history.
                          </p>
                        </div>
                      </div>
                    </div>
                  </details>
                </li>

              </ol>
            </div>
          </div>

          <!-- Placeholder for previous/next run diff -->
          <div class="bg-white border border-slate-200 rounded-2xl p-5 shadow-sm">
            <div class="flex items-start justify-between">
              <div>
                <p class="text-sm font-semibold">Evidence Diff (Between Runs)</p>
                <p class="text-sm text-slate-600 mt-1">
                  Compare evidence set across runs to show what changed and why.
                </p>
              </div>
              <span class="px-2.5 py-1 rounded-full bg-slate-100 text-slate-700 text-xs">
                optional (Phase E)
              </span>
            </div>

            <div class="mt-4 grid grid-cols-2 gap-4 text-sm">
              <div class="rounded-xl border border-slate-200 p-4 bg-slate-50">
                <p class="text-xs font-semibold text-slate-700">Added</p>
                <ul class="mt-2 space-y-2">
                  <li class="flex items-start justify-between gap-3">
                    <div class="min-w-0">
                      <p class="font-medium truncate">Procurement Policy 2024 — CL-4.2</p>
                      <p class="text-xs text-slate-500 truncate">p.12–13 • score 0.72</p>
                    </div>
                    <span class="text-xs px-2 py-1 rounded-full bg-emerald-50 text-emerald-800 border border-emerald-200">new</span>
                  </li>
                </ul>
              </div>

              <div class="rounded-xl border border-slate-200 p-4 bg-slate-50">
                <p class="text-xs font-semibold text-slate-700">Removed</p>
                <p class="mt-2 text-slate-500">—</p>
              </div>
            </div>
          </div>

        </div>

        <!-- RIGHT: Evidence Panel (Read-only) -->
        <div class="col-span-4 space-y-4">

          <div class="bg-white border border-slate-200 rounded-2xl p-5 shadow-sm">
            <div class="flex items-start justify-between">
              <div>
                <p class="text-sm font-semibold">Evidence Panel</p>
                <p class="text-xs text-slate-500 mt-1">Read-only • Audit-grade</p>
              </div>
              <span class="px-2 py-1 rounded-full bg-red-50 border border-red-200 text-red-800 text-xs font-medium">
                from EVIDENCE_ATTACHED
              </span>
            </div>

            <div class="mt-4 space-y-3">
              <!-- Evidence Card -->
              <div class="rounded-xl border border-slate-200 p-4 hover:border-slate-300 transition">
                <div class="flex items-start justify-between gap-3">
                  <div class="min-w-0">
                    <p class="font-medium truncate">Procurement Policy 2024</p>
                    <p class="text-xs text-slate-500 mt-0.5 truncate">
                      4.Approval / 4.2 High Value Procurement • Clause CL-4.2
                    </p>
                  </div>
                  <span class="mono text-xs px-2 py-1 rounded-full bg-slate-100 text-slate-700">
                    0.72
                  </span>
                </div>

                <p class="text-sm text-slate-700 mt-3 line-clamp-3">
                  “Any procurement with total value exceeding 200,000 THB must be escalated for COO approval.”
                </p>

                <div class="mt-3 flex items-center justify-between">
                  <div class="text-xs text-slate-500">
                    Pages <span class="mono">12–13</span>
                  </div>
                  <a
                    href="http://localhost:8000/api/files/procurement_2024.pdf#page=12"
                    target="_blank"
                    class="text-sm text-blue-600 hover:underline"
                  >
                    Open PDF at page
                  </a>
                </div>

                <div class="mt-3 flex flex-wrap gap-2">
                  <span class="px-2 py-0.5 rounded-full bg-amber-50 border border-amber-200 text-amber-900 text-xs mono">
                    supports rule: HIGH_AMOUNT_ESCALATION
                  </span>
                  <span class="px-2 py-0.5 rounded-full bg-slate-100 text-slate-700 text-xs mono">
                    run: 9867c2d5…57fa
                  </span>
                </div>
              </div>
            </div>

            <div class="mt-4 text-xs text-slate-500">
              Evidence is linked via audit events, not generated answers.
            </div>
          </div>

          <div class="bg-white border border-slate-200 rounded-2xl p-5 shadow-sm">
            <p class="text-sm font-semibold">UI Notes</p>
            <ul class="mt-3 text-sm text-slate-700 space-y-2 list-disc list-inside">
              <li>Expandable event = ลด noise, เพิ่มรายละเอียดเฉพาะเวลาต้องการ</li>
              <li>Run grouping = เล่าเรื่อง “decision attempt” ได้ครบ (rules → recommendation → evidence)</li>
              <li>Evidence card ต้องมี open_url ที่ resolve ได้จริง (PDF + page anchor)</li>
            </ul>
          </div>

        </div>

      </div>
    </div>
  </body>
</html>
