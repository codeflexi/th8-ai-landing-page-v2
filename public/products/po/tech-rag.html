<!doctype html>
<html lang="th">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TH8 – Step 4 Evidence (RAG-as-Evidence)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
      html, body { font-family: "Prompt", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
    </style>
  </head>
  <body class="bg-slate-50 text-slate-900">
    <div class="max-w-6xl mx-auto p-8 space-y-8">

      <header class="space-y-2">
        <div class="text-sm font-semibold text-slate-500">TH8.AI – Procurement Decision Center</div>
        <h1 class="text-3xl font-bold">Step 4: Evidence (RAG-as-Evidence)</h1>
        <p class="text-slate-600 max-w-3xl">
          Evidence เป็น “หลักฐานอ้างอิง” แบบ immutable ผ่าน audit event <span class="font-semibold">EVIDENCE_ATTACHED</span>
          (เปิด PDF/Clause ได้) ไม่ใช่ AI answer และไม่ derive meaning ใน backend
        </p>
      </header>

      <!-- Cards -->
      <section class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <div class="bg-white border border-slate-200 rounded-2xl p-5">
          <div class="text-xs font-semibold text-slate-500">Domain Object</div>
          <div class="mt-2 text-lg font-bold">EvidenceAttachment</div>
          <ul class="mt-3 text-sm text-slate-700 space-y-1">
            <li>• document: doc_id / title / uri</li>
            <li>• locator: page / clause / section</li>
            <li>• snippet + snippet_hash</li>
            <li>• retrieval: method / query / score</li>
            <li>• links: case_id + run_id + policy</li>
          </ul>
        </div>

        <div class="bg-white border border-slate-200 rounded-2xl p-5">
          <div class="text-xs font-semibold text-slate-500">Audit Event</div>
          <div class="mt-2 text-lg font-bold">EVIDENCE_ATTACHED</div>
          <p class="mt-3 text-sm text-slate-700">
            Immutable fact: ใครแนบอะไรให้ decision run ไหน และอ้างอิงกลับไปยัง PDF/Clause ได้เสมอ
          </p>
          <div class="mt-4 text-xs bg-slate-100 rounded-xl p-3 font-mono text-slate-700">
            payload.items[] → EvidenceAttachment
          </div>
        </div>

        <div class="bg-white border border-slate-200 rounded-2xl p-5">
          <div class="text-xs font-semibold text-slate-500">Extensibility</div>
          <div class="mt-2 text-lg font-bold">Vector วันนี้, Agent พรุ่งนี้</div>
          <p class="mt-3 text-sm text-slate-700">
            API/UI contract คงเดิม แค่สลับ implementation ของ EvidenceRetriever
          </p>
          <div class="mt-4 flex flex-wrap gap-2 text-xs">
            <span class="px-2 py-1 rounded-full bg-slate-100">VectorRetriever</span>
            <span class="px-2 py-1 rounded-full bg-slate-100">SQLRetriever</span>
            <span class="px-2 py-1 rounded-full bg-slate-100">AgentRouter</span>
          </div>
        </div>
      </section>

      <!-- Sequence -->
      <section class="bg-white border border-slate-200 rounded-2xl p-6">
        <div class="flex items-center justify-between">
          <h2 class="text-xl font-bold">Sequence (Decision → Evidence → Approval)</h2>
          <div class="text-xs font-semibold text-slate-500">Demo-clickable Flow</div>
        </div>

        <div class="mt-5 grid grid-cols-1 lg:grid-cols-5 gap-3 text-sm">
          <div class="rounded-xl border border-slate-200 p-4 bg-slate-50">
            <div class="font-semibold">User</div>
            <div class="text-slate-600 mt-1">Click “Run Decision”</div>
          </div>

          <div class="rounded-xl border border-slate-200 p-4">
            <div class="font-semibold">Decision API</div>
            <div class="text-slate-600 mt-1">POST /decisions/run</div>
            <div class="mt-2 text-xs bg-slate-100 rounded-lg p-2 font-mono">RULE_EVALUATED<br/>DECISION_RECOMMENDED</div>
          </div>

          <div class="rounded-xl border border-slate-200 p-4">
            <div class="font-semibold">Evidence API</div>
            <div class="text-slate-600 mt-1">POST /evidence/attach</div>
            <div class="mt-2 text-xs bg-slate-100 rounded-lg p-2 font-mono">EVIDENCE_ATTACHED</div>
          </div>

          <div class="rounded-xl border border-slate-200 p-4">
            <div class="font-semibold">Viewer</div>
            <div class="text-slate-600 mt-1">Open PDF/Clause</div>
            <div class="mt-2 text-xs bg-slate-100 rounded-lg p-2 font-mono">document.uri + page</div>
          </div>

          <div class="rounded-xl border border-slate-200 p-4 bg-slate-50">
            <div class="font-semibold">Approval</div>
            <div class="text-slate-600 mt-1">Approve/Reject + reason</div>
            <div class="mt-2 text-xs bg-slate-100 rounded-lg p-2 font-mono">DECISION_APPROVED<br/>DECISION_REJECTED</div>
          </div>
        </div>

        <div class="mt-5 text-sm text-slate-700">
          หลักการ: Backend เก็บแต่ immutable facts (audit events) และ frontend derive decision state จาก audit timeline เท่านั้น
        </div>
      </section>

      <!-- API Summary -->
      <section class="bg-white border border-slate-200 rounded-2xl p-6">
        <h2 class="text-xl font-bold">API (Phase A)</h2>
        <div class="mt-4 grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
          <div class="rounded-xl border border-slate-200 p-4">
            <div class="font-semibold">POST /api/evidence/attach</div>
            <div class="text-slate-600 mt-1">Write EVIDENCE_ATTACHED (audit-only)</div>
          </div>
          <div class="rounded-xl border border-slate-200 p-4">
            <div class="font-semibold">GET /api/evidence/case/{case_id}?run_id=...</div>
            <div class="text-slate-600 mt-1">Read from audit events</div>
          </div>
        </div>
      </section>

    </div>
  </body>
</html>
